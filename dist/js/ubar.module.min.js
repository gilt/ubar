!function(e,t){"use strict";function n(){function e(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;if(0===n&&1===arguments.length)throw new TypeError;var o,r=0;if(arguments.length>=2)o=arguments[1];else for(;;){if(r in t){o=t[r++];break}if(++r>=n)throw new TypeError}for(;n>r;)r in t&&(o=e.call(void 0,o,t[r],r,t)),r++;return o}function t(e){function t(){}return t.prototype=e,new t}function n(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;return function(){return this.replace(e,"")}}return Object.create=Object.create||t,Array.prototype.reduce=Array.prototype.reduce||e,String.prototype.trim=String.prototype.trim||n,{}}"function"==typeof define&&define.amd?define(t,[],n):"object"==typeof module&&module.exports?module.exports=n():e[t]=n()}("object"==typeof exports&&exports||this,"ubar_es5_polyfill"),function(e,t){"use strict";function n(){function e(e){l=e}function t(){return l?l:navigator.userAgent}function n(){return null!==t().match(/iPhone|iPad|iPod/i)}function o(){return null!==t().match(/Android/i)}function r(){return null!==t().match(/IEMobile/i)}function i(){try{return parseFloat(t().match(/OS (\d+)_(\d+)/)[0].split(" ")[1].replace("_","."),10)}catch(e){return console.log("Tring to get IOS version for non-IOS device. ",e.message),0}}function s(){try{return parseFloat(t().match(/Android (\d+).(\d+)/)[0].split(" ")[1],10)}catch(e){return console.log("Tring to get Android version for non-Android device. ",e.message),0}}function u(){try{return parseFloat(t().match(/(IEMobile\/)((\d+).(\d+))/)[0].split("/")[1],10)}catch(e){return console.log("Tring to get WindowsMobile version for non-WindowMobile device. ",e.message),0}}function a(e){return n()&&i()>=e}function c(e){return o()&&s()>=e}function p(e){return r()&&u()>=e}function d(e){return e.ios_support&&a(e.min_ios_support)||e.android_support&&c(e.min_android_support)||e.windows_mobile_support&&p(e.min_windows_mobile_support)}var l;return{isAppSupported:d,isIOS:n,isAndroid:o,isWindowsMobile:r,_setUserAgent:e,_isSupportedIOS:a,_isSupportedAndroid:c,_isSupportedWindowsMobile:p,_getIOSVersion:i,_getAndroidVersion:s,_getWindowsMobileVersion:u}}"function"==typeof define&&define.amd?define(t,[],n):"object"==typeof module&&module.exports?module.exports=n():e[t]=n()}("object"==typeof exports&&exports||this,"ubar_device"),function(e,t){"use strict";function n(){function e(e,t){""!==e&&void 0!==e&&(n.hasOwnProperty(e)||(n[e]=[]),n[e].push(t))}function t(e,t){if(n.hasOwnProperty(e))for(var o=0;o<n[e].length;o++)"function"==typeof n[e][o]&&n[e][o](void 0!==t?t:{})}var n={};return{subscribe:e,publish:t}}"function"==typeof define&&define.amd?define(t,[],n):"object"==typeof module&&module.exports?module.exports=n():e[t]=n()}("object"==typeof exports&&exports||this,"ubar_pubsub"),function(e,t){"use strict";function n(e,t,n){function o(o){var r=t.defer();return n({url:o,type:"text",success:function(t){r.resolve(e.compile(t.responseText))}}),r.promise}function r(e){return s[e]||(s[e]=o(e)),s[e]}function i(e,t){return t=t||{},r(e).then(function(e){return e(t)})}var s=s||{},u=function(e){this.MAIN_UBAR_CLASS=e.component_class,this.UBAR_SHOW_CLASS=e.ubar_show_class,this.UBAR_HIDE_CLASS=e.ubar_hide_class,this._renderTemplate=e.renderTemplate||i,this._loadTemplate=e.loadTemplate||r};return u.prototype.renderBanner=function(e){var t=this,n=document.createElement("div");return this._renderTemplate(e).then(function(e){n.innerHTML=e,document.body.insertBefore(n,document.body.firstChild),t.banner=document.querySelectorAll("."+t.MAIN_UBAR_CLASS)[0]})},u.prototype.loadBanner=function(e){this._loadTemplate(e)},u.prototype.remove=function(){this.banner&&this.banner.parentElement&&(document.body.removeChild(this.banner.parentElement),this.banner=void 0)},u.prototype.hide=function(){this.banner.classList.remove(this.UBAR_SHOW_CLASS),this.banner.classList.add(this.UBAR_HIDE_CLASS)},u.prototype.show=function(){this.banner.classList.remove(this.UBAR_HIDE_CLASS),this.banner.classList.add(this.UBAR_SHOW_CLASS)},u}"function"==typeof define&&define.amd?define(t,["handlebars","when","reqwest"],n):"object"==typeof module&&module.exports?module.exports=n(require("handlebars"),require("when"),require("reqwest")):e[t]=n(e.handlebars||handlebars,e.when||when,e.reqwest||reqwest)}("object"==typeof exports&&exports||this,"ubar_dom"),function(e,t){"use strict";function n(e){function t(t){var n,o,r,i;return i=e.duration(0),t?(n=t.trim().split(/\s+/),o=parseInt(n[0],10),r=n[1],n.length>2?(console.error("Error: time_string has invalid parameters: "+n),i):e.duration(o,r)):(console.error("Error: empty time_string in getTimeinMoments"),i)}function n(e){return"function"==typeof e.asSeconds?e.asSeconds():t(e).asSeconds()}function o(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function r(e){if(!o(e))return e;for(var t,n,r=1,s=arguments.length;s>r;r++){t=arguments[r];for(n in t)i.call(t,n)&&(e[n]=t[n])}return e}var i=Object.prototype.hasOwnProperty;return{getTimeInMoments:t,getTimeInSeconds:n,isObject:o,extend:r}}"function"==typeof define&&define.amd?define(t,["moment"],n):"object"==typeof module&&module.exports?module.exports=n(require("moment")):e[t]=n(e.moment||moment)}("object"==typeof exports&&exports||this,"ubar_helpers"),function(e,t){"use strict";function n(e,t){var n=function(e){this.app_store_redirect=t.duration(e.app_store_redirect).asMilliseconds(),this.app_deep_link_url=this.getAppDeepLink(e),this.app_store_url=this.getAppStoreUrl(e)};return n.prototype.redirectToApp=function(e){e=e||this.app_deep_link_url;var t=document.createElement("IFRAME");t.style.display="none",t.id="app-linker",t.setAttribute("src",e),document.body.appendChild(t)},n.prototype.getAppDeepLink=function(t){return e.isWindowsMobile()?t.windows_app_deep_link:e.isAndroid()?t.android_app_deep_link:t.ios_app_deep_link},n.prototype.getAppStoreUrl=function(t){return e.isWindowsMobile()?t.windows_app_store_url:e.isAndroid()?t.android_app_store_url:t.ios_app_store_url},n.prototype.redirectToAppStore=function(){window.location.href=this.app_store_url},n.prototype.redirectWithFallback=function(e,t,n){t=t||function(){},e=e||function(){};var o,r=this.app_store_redirect,i=Date.now(),s=i+r,u=r/3,a=u/2,c=this;o=setInterval(function(){i=Date.now(),i>=s-a&&s+a>=i?(t(),c.redirectToAppStore(),clearInterval(o)):i>s+a&&(e(),clearInterval(o))},u),c.redirectToApp(n)},n}"function"==typeof define&&define.amd?define(t,["./device","moment"],n):"object"==typeof module&&module.exports?module.exports=n(require("./device"),require("moment")):e[t]=n(e.ubar_device||ubar_device,e.moment||moment)}("object"==typeof exports&&exports||this,"ubar_resolver"),function(e,t){"use strict";function n(e){var t;return t=function(t){return t?(this.UBAR_KEY=t.device_preference_cookie,this.REDIRECTED_NAME=t.redirected_cookie,this.EXP_DURATION_REDIRECTED_MS=e.getTimeInSeconds(t.manage_window_time),this.EXP_DURATION_DISABLED_MS=e.getTimeInSeconds(t.disabled_time),void(this.EXP_DURATION_ENABLED_MS=e.getTimeInSeconds(t.enabled_time))):(console.log("Error: ubarStorage initialized with an empty config."),this.UBAR_KEY="",this.REDIRECTED_NAME="",this.EXP_DURATION_REDIRECTED_MS=0,this.EXP_DURATION_DISABLED_MS=0,void(this.EXP_DURATION_ENABLED_MS=0))},t.prototype.docCookies={getItem:function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(e,t,n,o,r,i){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var s="";if(n)switch(n.constructor){case Number:s=1/0===n?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:s="; expires="+n;break;case Date:s="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(r?"; domain="+r:"")+(o?"; path="+o:"")+(i?"; secure":""),!0},removeItem:function(e,t,n){return this.hasItem(e)?(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(t?"; path="+t:""),!0):!1},hasItem:function(e){return e?new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1}},t.prototype.isEnabled=function(){return"true"===this.docCookies.getItem(this.UBAR_KEY)},t.prototype.isDisabled=function(){return"false"===this.docCookies.getItem(this.UBAR_KEY)},t.prototype.isUserRedirected=function(){return"true"===this.docCookies.getItem(this.REDIRECTED_NAME)},t.prototype.setRedirected=function(){this.docCookies.setItem(this.REDIRECTED_NAME,!0,this.EXP_DURATION_REDIRECTED_MS)},t.prototype.disable=function(){this.docCookies.setItem(this.UBAR_KEY,!1,this.EXP_DURATION_DISABLED_MS)},t.prototype.enable=function(){this.docCookies.setItem(this.UBAR_KEY,!0,this.EXP_DURATION_ENABLED_MS)},t.prototype.clear=function(){this.docCookies.removeItem(this.UBAR_KEY),this.docCookies.removeItem(this.REDIRECTED_NAME)},t}"function"==typeof define&&define.amd?define(t,["./helpers"],n):"object"==typeof module&&module.exports?module.exports=n(require("./helpers")):e[t]=n(e.ubar_helpers||ubar_helpers)}("object"==typeof exports&&exports||this,"ubar_storage"),function(e,t){"use strict";function n(e){function t(t){e.publish("turnedUbarOn",t)}function n(t){e.publish("turnedUbarOff",t)}function o(t){e.publish("choseDownloadApp",t)}function r(t){e.publish("closedBanner",t)}function i(t){e.publish("returnedToApp",t)}function s(t){e.publish("attemptedToRedirectToAppStore",t)}function u(t){e.publish("attemptedToRedirectToApp",t)}function a(t){e.publish("showedBanner",t)}return{turnUbarOn:t,turnUbarOff:n,choseDownloadApp:o,closeBanner:r,returnToApp:i,attemptToRedirectToAppStore:s,attemptToRedirectToApp:u,showBanner:a}}"function"==typeof define&&define.amd?define(t,["./pubsub"],n):"object"==typeof module&&module.exports?module.exports=n(require("./pubsub")):e[t]=n(e.ubar_pubsub||ubar_pubsub)}("object"==typeof exports&&exports||this,"ubar_tracking"),function(e,t){"use strict";function n(e){var t={ios_app_store_url:"https://itunes.apple.com/us/app/appname/id331804452?mt=8",ios_app_deep_link:"gilt://",android_app_store_url:"https://play.google.com/store/apps/details?id=com.gilt.android&hl=en",android_app_deep_link:"gilt://",windows_app_store_url:"http://www.windowsphone.com/en-us/store/app/gilt/fff0a9b7-074c-4a43-805d-cb6c81e319f8",windows_app_deep_link:"gilt://"},n={sending_template_path:"templates/ubar/ubar_sending.handlebars",returning_template_path:"templates/ubar/ubar_returning.handlebars"},o={enabled_time:"1 year",disabled_time:"2 weeks",manage_window_time:"60 seconds"},r={component_class:"component-ubar",on_button_class:"ubar-open-app-button",install_class:"ubar-install-app-button",off_class:"ubar-preferences-button",open_in_app_class:"ubar-open-page-in-app-button",close_button_class:"ubar-close-button",ubar_show_class:"ubar-show",ubar_hide_class:"ubar-hide"},i={device_preference_cookie:"ubar",redirected_cookie:"ubar_redirected"},s={tracking_sending_banner:"sending banner",tracking_returning_banner:"returning banner",tracking_account_location:"account",tracking_immediate_redirection:"user immediately redirected"},u={app_store_redirect:"2.0 seconds"},a={ios_support:!0,min_ios_support:7,android_support:!1,min_android_support:4.3,windows_mobile_support:!1,min_windows_mobile_support:1/0},c=e.extend(t,n,o,r,i,s,u,a);return c}"function"==typeof define&&define.amd?define(t,["./ubar_helpers"],n):"object"==typeof module&&module.exports?module.exports=n(require("./helpers")):e[t]=n(e.ubar_helpers||ubar_helpers)}("object"==typeof exports&&exports||this,"ubar_config"),function(e,t){"use strict";function n(e,t,n,o,r,i,s,u,a,c){function p(e){var t=document.querySelectorAll("."+e.component_class)[0],n=t.querySelectorAll("."+e.on_button_class)[0],o=t.querySelectorAll("."+e.install_class)[0],r=t.querySelectorAll("."+e.close_button_class)[0];c.on(n,"touchstart",function(t){t.preventDefault(),g.enable(),a.turnUbarOn({location:e.tracking_sending_banner}),l(e.tracking_sending_banner,e)}),c.on(o,"touchstart",function(t){t.preventDefault(),a.choseDownloadApp({location:e.tracking_sending_banner}),A.redirectToAppStore()}),c.on(r,"touchstart",function(t){t.preventDefault(),a.closeBanner({location:e.tracking_sending_banner}),a.turnUbarOff({location:e.tracking_sending_banner}),y.remove(),g.disable()})}function d(e){var t=document.querySelectorAll("."+e.component_class)[0],n=t.querySelectorAll("."+e.off_class)[0],o=t.querySelectorAll("."+e.open_in_app_class)[0],r=t.querySelectorAll("."+e.close_button_class)[0];c.on(n,"touchstart",function(t){t.preventDefault(),y.remove(),g.disable(),a.turnUbarOff({location:e.tracking_returning_banner})}),c.on(o,"touchstart",function(t){t.preventDefault(),a.returnToApp(),l(e.tracking_returning_banner,e)}),c.on(r,"touchstart",function(t){t.preventDefault(),a.closeBanner({location:e.tracking_returning_banner}),a.turnUbarOff({location:e.tracking_returning_banner}),y.remove(),g.disable()})}function l(e,t){var n=function(){},o=function(){a.attemptToRedirectToAppStore({location:e})};g.setRedirected(),y.remove(),_(t).then(function(){a.attemptToRedirectToApp({location:e}),A.redirectWithFallback(n,o)})}function _(e){return y.renderBanner(e.returning_template_path).then(function(){d(e),y.show(),a.showBanner({location:e.tracking_returning_banner})})}function f(e){return y.renderBanner(e.sending_template_path).then(function(){p(e),y.show(),a.showBanner({location:e.tracking_sending_banner})})}function b(e){return e.enabled_time=s.getTimeInMoments(e.enabled_time),e.disabled_time=s.getTimeInMoments(e.disabled_time),e.manage_window_time=s.getTimeInMoments(e.manage_window_time),e.app_store_redirect=s.getTimeInMoments(e.app_store_redirect),e}function m(e){return w||(w=new h(e)),w}var h,g,y,A,w;return h=function(e){this.config=b(s.extend(t,e)),r.isAppSupported(this.config)?(g=new n(this.config),this.enable=g.enable,this.disable=g.disable,this.isDisabled=g.isDisabled,this.isEnabled=g.isEnabled,this.subscribe=i.subscribe):(this.enable=function(){},this.disable=function(){},this.isDisabled=function(){},this.isEnabled=function(){},this.subscribe=function(){})},h.prototype.render=function(){var e=this;r.isAppSupported(e.config)&&(y=new o(e.config),A=new u(e.config),y.loadBanner(e.config.returning_template_path),g.isEnabled()?g.isUserRedirected()?_(e.config):l(e.config.tracking_immediate_redirection,e.config):g.isDisabled()||f(e.config))},{init:m}}"function"==typeof define&&define.amd?define(t,["./es5_polyfill","./config","./storage","./dom","./device","./pubsub","./helpers","./resolver","./tracking","bean","when","moment",".es5_polyfill"],n):"object"==typeof module&&module.exports?module.exports=n(require("./es5_polyfill"),require("./config"),require("./storage"),require("./dom"),require("./device"),require("./pubsub"),require("./helpers"),require("./resolver"),require("./tracking"),require("bean"),require("when"),require("moment")):e[t]=n(e.ubar_es5_polyfill||ubar_es5_polyfill,e.ubar_config||ubar_config,e.ubar_storage||ubar_storage,e.ubar_dom||ubar_dom,e.ubar_device||ubar_device,e.ubar_pubsub||ubar_pubsub,e.ubar_helpers||ubar_helpers,e.ubar_resolver||ubar_resolver,e.ubar_tracking||ubar_tracking,e.bean||bean,e.when||when,e.moment||moment)}("object"==typeof exports&&exports||this,"ubar");