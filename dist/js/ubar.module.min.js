!function(e,t){"use strict";function n(){function e(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;if(0===n&&1===arguments.length)throw new TypeError;var o,r=0;if(arguments.length>=2)o=arguments[1];else for(;;){if(r in t){o=t[r++];break}if(++r>=n)throw new TypeError}for(;r<n;)r in t&&(o=e.call(void 0,o,t[r],r,t)),r++;return o}function t(e){var t,n=function(){};if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return n.prototype=e,t=new n,n.prototype=null,t}function n(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;return this.replace(e,"")}return Object.create=Object.create||t,Array.prototype.reduce=Array.prototype.reduce||e,String.prototype.trim=String.prototype.trim||n,{}}"function"==typeof define&&define.amd?define(t,[],n):"object"==typeof module&&module.exports?module.exports=n():e[t]=n()}("object"==typeof exports&&exports||this,"ubar_es5_polyfill"),function(e,t){"use strict";function n(){function e(e){_=e}function t(){return _?_:navigator.userAgent}function n(){return null!==t().match(/iPhone|iPad|iPod/i)}function o(){return n()&&null!==t().match(/Version\//i)}function r(){return null!==t().match(/Android/i)}function i(){return null!==t().match(/IEMobile/i)}function s(){try{return parseFloat(t().match(/OS (\d+)_(\d+)/)[0].split(" ")[1].replace("_","."),10)}catch(e){return console.log("Trying to get IOS version for non-IOS device. ",e.message),0}}function u(){try{return parseFloat(t().match(/Android (\d+).(\d+)/)[0].split(" ")[1],10)}catch(e){return console.log("Trying to get Android version for non-Android device. ",e.message),0}}function a(){try{return parseFloat(t().match(/(IEMobile\/)((\d+).(\d+))/)[0].split("/")[1],10)}catch(e){return console.log("Trying to get WindowsMobile version for non-WindowMobile device. ",e.message),0}}function c(e){return n()&&s()>=e}function p(e){return r()&&u()>=e}function d(e){return i()&&a()>=e}function l(e){return e.ios_support&&c(e.min_ios_support)||e.android_support&&p(e.min_android_support)||e.windows_mobile_support&&d(e.min_windows_mobile_support)}var _;return{isAppSupported:l,isIOS:n,isIosSafari:o,isAndroid:r,isWindowsMobile:i,_setUserAgent:e,_isSupportedIOS:c,_isSupportedAndroid:p,_isSupportedWindowsMobile:d,_getIOSVersion:s,_getAndroidVersion:u,_getWindowsMobileVersion:a}}"function"==typeof define&&define.amd?define(t,[],n):"object"==typeof module&&module.exports?module.exports=n():e[t]=n()}("object"==typeof exports&&exports||this,"ubar_device"),function(e,t){"use strict";function n(){function e(e,t){""!==e&&void 0!==e&&(n.hasOwnProperty(e)||(n[e]=[]),n[e].push(t))}function t(e,t){if(n.hasOwnProperty(e))for(var o=0;o<n[e].length;o++)"function"==typeof n[e][o]&&n[e][o](void 0!==t?t:{})}var n={};return{subscribe:e,publish:t}}"function"==typeof define&&define.amd?define(t,[],n):"object"==typeof module&&module.exports?module.exports=n():e[t]=n()}("object"==typeof exports&&exports||this,"ubar_pubsub"),function(e,t){"use strict";function n(e,t,n){function o(o){var r=t.defer();return n({url:o,type:"text",success:function(t){r.resolve(e.compile(t.responseText))}}),r.promise}function r(e){return s[e]||(s[e]=o(e)),s[e]}function i(e,t){return t=t||{},r(e).then(function(e){return e(t)})}var s=s||{},u=function(e){this.MAIN_UBAR_CLASS=e.component_class,this.UBAR_SHOW_CLASS=e.ubar_show_class,this.UBAR_HIDE_CLASS=e.ubar_hide_class,this.UBAR_CONTAINER_CLASS=e.ubar_container,this._renderTemplate=e.renderTemplate||i,this._loadTemplate=e.loadTemplate||r};return u.prototype.renderBanner=function(e){var t=this,n=document.querySelector("."+t.UBAR_CONTAINER_CLASS);return this._renderTemplate(e).then(function(e){n||(n=document.createElement("div"),document.body.insertBefore(n,document.body.firstChild)),n.innerHTML=e,t.banner=n.querySelector("."+t.MAIN_UBAR_CLASS)})},u.prototype.loadBanner=function(e){this._loadTemplate(e)},u.prototype.remove=function(){this.banner&&this.banner.parentElement&&(this.banner.parentElement.remove(),this.banner=void 0)},u.prototype.hide=function(){this.banner.classList.remove(this.UBAR_SHOW_CLASS),this.banner.classList.add(this.UBAR_HIDE_CLASS)},u.prototype.show=function(){this.banner.classList.remove(this.UBAR_HIDE_CLASS),this.banner.classList.add(this.UBAR_SHOW_CLASS)},u}"function"==typeof define&&define.amd?define(t,["handlebars","when","reqwest"],n):"object"==typeof module&&module.exports?module.exports=n(require("handlebars"),require("when"),require("reqwest")):e[t]=n(e.handlebars||handlebars,e.when||when,e.reqwest||reqwest)}("object"==typeof exports&&exports||this,"ubar_dom"),function(e,t){"use strict";function n(e){function t(t){var n,o,r,i;return i=e.duration(0),t?(n=t.trim().split(/\s+/),o=parseInt(n[0],10),r=n[1],n.length>2?(console.error("Error: time_string has invalid parameters: "+n),i):e.duration(o,r)):(console.error("Error: empty time_string in getTimeinMoments"),i)}function n(e){return"function"==typeof e.asSeconds?e.asSeconds():t(e).asSeconds()}function o(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function r(e){if(!o(e))return e;for(var t,n,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(n in t)s.call(t,n)&&(e[n]=t[n])}return e}function i(e,t){return function(){return e.apply(t,arguments)}}var s=Object.prototype.hasOwnProperty;return{getTimeInMoments:t,getTimeInSeconds:n,isObject:o,extend:r,bind:i}}"function"==typeof define&&define.amd?define(t,["moment"],n):"object"==typeof module&&module.exports?module.exports=n(require("moment")):e[t]=n(e.moment||moment)}("object"==typeof exports&&exports||this,"ubar_helpers"),function(e,t){"use strict";function n(e,t){function n(t){return e.isWindowsMobile()?t.windows_app_deep_link:e.isAndroid()?t.android_app_deep_link:t.ios_app_deep_link}function o(t){return e.isWindowsMobile()?t.windows_app_store_url:e.isAndroid()?t.android_app_store_url:t.ios_app_store_url}var r=function(e){this.appStoreRedirect=t.duration(e.app_store_redirect).asMilliseconds(),this.appDeepLinkUrl=n(e),this.appStoreUrl=o(e)};return r.prototype.redirectToApp=function(t){if(t=t||this.appDeepLinkUrl,e.isIOS()&&e._getIOSVersion()>=9)window.location.href=t;else{var n=document.createElement("IFRAME");n.style.display="none",n.id="app-linker",n.setAttribute("src",t),document.body.appendChild(n)}},r.prototype.redirectToAppStore=function(){window.location.href=this.appStoreUrl},r.prototype.redirectWithFallback=function(e,t,n){t=t||function(){},e=e||function(){};var o,r=this.appStoreRedirect,i=Date.now(),s=i+r,u=r/3,a=u/2,c=this;o=setInterval(function(){i=Date.now(),i>=s-a&&i<=s+a?(t(),c.redirectToAppStore(),clearInterval(o)):i>s+a&&(e(),clearInterval(o))},u),c.redirectToApp(n)},r}"function"==typeof define&&define.amd?define(t,["./device","moment"],n):"object"==typeof module&&module.exports?module.exports=n(require("./device"),require("moment")):e[t]=n(e.ubar_device||ubar_device,e.moment||moment)}("object"==typeof exports&&exports||this,"ubar_resolver"),function(e,t){"use strict";function n(e){var t,n="/";return t=function(t){return t?(this.UBAR_KEY=t.device_preference_cookie,this.REDIRECTED_NAME=t.redirected_cookie,this.EXP_DURATION_REDIRECTED_MS=e.getTimeInSeconds(t.manage_window_time),this.EXP_DURATION_DISABLED_MS=e.getTimeInSeconds(t.disabled_time),void(this.EXP_DURATION_ENABLED_MS=e.getTimeInSeconds(t.enabled_time))):(console.log("Error: ubarStorage initialized with an empty config."),this.UBAR_KEY="",this.REDIRECTED_NAME="",this.EXP_DURATION_REDIRECTED_MS=0,this.EXP_DURATION_DISABLED_MS=0,void(this.EXP_DURATION_ENABLED_MS=0))},t.prototype.docCookies={getItem:function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(e,t,n,o,r,i){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var s="";if(n)switch(n.constructor){case Number:s=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:s="; expires="+n;break;case Date:s="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(r?"; domain="+r:"")+(o?"; path="+o:"")+(i?"; secure":""),!0},removeItem:function(e,t,n){return!!this.hasItem(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(t?"; path="+t:""),!0)},hasItem:function(e){return!!e&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}},t.prototype.isEnabled=function(){return"true"===this.docCookies.getItem(this.UBAR_KEY)},t.prototype.isDisabled=function(){return"false"===this.docCookies.getItem(this.UBAR_KEY)},t.prototype.isUserRedirected=function(){return"true"===this.docCookies.getItem(this.REDIRECTED_NAME)},t.prototype.setRedirected=function(){this.docCookies.setItem(this.REDIRECTED_NAME,!0,this.EXP_DURATION_REDIRECTED_MS,n)},t.prototype.disable=function(){this.docCookies.setItem(this.UBAR_KEY,!1,this.EXP_DURATION_DISABLED_MS,n)},t.prototype.enable=function(){this.docCookies.setItem(this.UBAR_KEY,!0,this.EXP_DURATION_ENABLED_MS,n)},t.prototype.clear=function(){this.docCookies.removeItem(this.UBAR_KEY,n),this.docCookies.removeItem(this.REDIRECTED_NAME,n)},t}"function"==typeof define&&define.amd?define(t,["./helpers"],n):"object"==typeof module&&module.exports?module.exports=n(require("./helpers")):e[t]=n(e.ubar_helpers||ubar_helpers)}("object"==typeof exports&&exports||this,"ubar_storage"),function(e,t){"use strict";function n(e){function t(t){e.publish("turnedUbarOn",t)}function n(t){e.publish("turnedUbarOff",t)}function o(t){e.publish("choseDownloadApp",t)}function r(t){e.publish("closedBanner",t)}function i(t){e.publish("returnedToApp",t)}function s(t){e.publish("attemptedToRedirectToAppStore",t)}function u(t){e.publish("attemptedToRedirectToApp",t)}function a(t){e.publish("showedBanner",t)}return{turnUbarOn:t,turnUbarOff:n,choseDownloadApp:o,closeBanner:r,returnToApp:i,attemptToRedirectToAppStore:s,attemptToRedirectToApp:u,showBanner:a}}"function"==typeof define&&define.amd?define(t,["./pubsub"],n):"object"==typeof module&&module.exports?module.exports=n(require("./pubsub")):e[t]=n(e.ubar_pubsub||ubar_pubsub)}("object"==typeof exports&&exports||this,"ubar_tracking"),function(e,t){"use strict";function n(e){var t={ios_app_store_url:"https://itunes.apple.com/us/app/appname/id331804452?mt=8",ios_app_deep_link:"gilt://",android_app_store_url:"https://play.google.com/store/apps/details?id=com.gilt.android&hl=en",android_app_deep_link:"gilt://",windows_app_store_url:"http://www.windowsphone.com/en-us/store/app/gilt/fff0a9b7-074c-4a43-805d-cb6c81e319f8",windows_app_deep_link:"gilt://"},n={sending_template_path:"templates/ubar/ubar_sending.handlebars",returning_template_path:"templates/ubar/ubar_returning.handlebars"},o={enabled_time:"1 year",disabled_time:"2 weeks",manage_window_time:"60 seconds"},r={component_class:"component-ubar",on_button_class:"ubar-open-app-button",install_class:"ubar-install-app-button",off_class:"ubar-preferences-button",open_in_app_class:"ubar-open-page-in-app-button",close_button_class:"ubar-close-button",ubar_show_class:"ubar-show",ubar_hide_class:"ubar-hide",ubar_container:"ubar-container"},i={device_preference_cookie:"ubar",redirected_cookie:"ubar_redirected"},s={tracking_sending_banner:"sending banner",tracking_returning_banner:"returning banner",tracking_account_location:"account",tracking_immediate_redirection:"user immediately redirected"},u={app_store_redirect:"2.0 seconds"},a={ios_support:!0,min_ios_support:7,android_support:!1,min_android_support:4.3,windows_mobile_support:!1,min_windows_mobile_support:1/0},c=e.extend(t,n,o,r,i,s,u,a);return c}"function"==typeof define&&define.amd?define(t,["./ubar_helpers"],n):"object"==typeof module&&module.exports?module.exports=n(require("./helpers")):e[t]=n(e.ubar_helpers||ubar_helpers)}("object"==typeof exports&&exports||this,"ubar_config"),function(e,t){"use strict";function n(e,t,n,o,r,i,s,u,a,c,p){function d(e){var t=document.querySelectorAll("."+e.component_class)[0],n=t.querySelectorAll("."+e.on_button_class)[0],o=t.querySelectorAll("."+e.install_class)[0],r=t.querySelectorAll("."+e.close_button_class)[0];c.on(n,"touchend",function(t){t.preventDefault(),y.enable(),a.turnUbarOn({location:e.tracking_sending_banner}),_(e.tracking_sending_banner,e)}),c.on(o,"touchend",function(t){t.preventDefault(),a.choseDownloadApp({location:e.tracking_sending_banner}),w.redirectToAppStore()}),c.on(r,"touchend",function(t){t.preventDefault(),a.closeBanner({location:e.tracking_sending_banner}),a.turnUbarOff({location:e.tracking_sending_banner}),y.disable(),A.remove()})}function l(e){var t=document.querySelectorAll("."+e.component_class)[0],n=t.querySelectorAll("."+e.off_class)[0],o=t.querySelectorAll("."+e.open_in_app_class)[0],r=t.querySelectorAll("."+e.close_button_class)[0];c.on(n,"touchend",function(t){t.preventDefault(),A.remove(),y.disable(),a.turnUbarOff({location:e.tracking_returning_banner})}),c.on(o,"touchend",function(t){t.preventDefault(),a.returnToApp(),_(e.tracking_returning_banner,e)}),c.on(r,"touchend",function(t){t.preventDefault(),a.closeBanner({location:e.tracking_returning_banner}),a.turnUbarOff({location:e.tracking_returning_banner}),A.remove(),y.disable()})}function _(e,t){var n=function(){},o=function(){a.attemptToRedirectToAppStore({location:e})};y.setRedirected(),A.remove(),f(t).then(function(){a.attemptToRedirectToApp({location:e}),w.redirectWithFallback(n,o)})}function f(e){return A.renderBanner(e.returning_template_path).then(function(){l(e),A.show(),a.showBanner({location:e.tracking_returning_banner})})}function b(e){return A.renderBanner(e.sending_template_path).then(function(){d(e),A.show(),a.showBanner({location:e.tracking_sending_banner})})}function m(e){return e.enabled_time=s.getTimeInMoments(e.enabled_time),e.disabled_time=s.getTimeInMoments(e.disabled_time),e.manage_window_time=s.getTimeInMoments(e.manage_window_time),e.app_store_redirect=s.getTimeInMoments(e.app_store_redirect),e}function h(e){return E||(E=new g(e)),E}var g,y,A,w,E;return g=function(e){this.config=m(s.extend(t,e)),r.isAppSupported(this.config)?(y=new n(this.config),this.enable=s.bind(y.enable,y),this.disable=s.bind(y.disable,y),this.isDisabled=s.bind(y.isDisabled,y),this.isEnabled=s.bind(y.isEnabled,y),this.subscribe=i.subscribe):(this.enable=function(){},this.disable=function(){},this.isDisabled=function(){},this.isEnabled=function(){},this.subscribe=function(){})},g.prototype.render=function(){var e=this;r.isAppSupported(e.config)&&(A=new o(e.config),w=new u(e.config),A.loadBanner(e.config.returning_template_path),y.isEnabled()?y.isUserRedirected()?f(e.config):_(e.config.tracking_immediate_redirection,e.config):y.isDisabled()||b(e.config))},{init:h}}"function"==typeof define&&define.amd?define(t,["./es5_polyfill","./config","./storage","./dom","./device","./pubsub","./helpers","./resolver","./tracking","bean","when","moment"],n):"object"==typeof module&&module.exports?module.exports=n(require("./es5_polyfill"),require("./config"),require("./storage"),require("./dom"),require("./device"),require("./pubsub"),require("./helpers"),require("./resolver"),require("./tracking"),require("bean"),require("when"),require("moment")):e[t]=n(e.ubar_es5_polyfill||ubar_es5_polyfill,e.ubar_config||ubar_config,e.ubar_storage||ubar_storage,e.ubar_dom||ubar_dom,e.ubar_device||ubar_device,e.ubar_pubsub||ubar_pubsub,e.ubar_helpers||ubar_helpers,e.ubar_resolver||ubar_resolver,e.ubar_tracking||ubar_tracking,e.bean||bean,e.when||when,e.moment||moment)}("object"==typeof exports&&exports||this,"ubar");